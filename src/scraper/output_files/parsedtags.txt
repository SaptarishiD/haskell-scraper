[TagOpen "!DOCTYPE" [("html","")],TagText "\n",TagOpen "html" [("xmlns","http://www.w3.org/1999/xhtml"),("xmlns:og","http://ogp.me/ns#"),("xmlns:fb","https://www.facebook.com/2008/fbml")],TagText "\n",TagOpen "head" [],TagText "\n    ",TagOpen "title" [],TagText "Type erasure and reification - Eli Bendersky's website",TagClose "title",TagText "\n    ",TagComment " Using the latest rendering mode for IE ",TagText "\n    ",TagOpen "meta" [("http-equiv","X-UA-Compatible"),("content","IE=edge")],TagText "\n    ",TagOpen "meta" [("charset","utf-8")],TagText "\n    ",TagOpen "meta" [("name","viewport"),("content","width=device-width, initial-scale=1.0")],TagText "\n\n    ",TagOpen "link" [("href","https://eli.thegreenplace.net/favicon.ico"),("rel","icon")],TagText "\n\n    ",TagComment " Bootstrap ",TagText "\n        ",TagOpen "link" [("rel","stylesheet"),("href","https://eli.thegreenplace.net/theme/css/bootstrap.min.css"),("type","text/css")],TagClose "link",TagText "\n    ",TagOpen "link" [("href","https://eli.thegreenplace.net/theme/css/font-awesome.min.css"),("rel","stylesheet")],TagText "\n\n    ",TagOpen "link" [("href","https://eli.thegreenplace.net/theme/css/pygments/vs.css"),("rel","stylesheet")],TagText "\n    ",TagOpen "link" [("rel","stylesheet"),("href","https://eli.thegreenplace.net/theme/css/style.css"),("type","text/css")],TagClose "link",TagText "\n\n        ",TagOpen "link" [("href","https://eli.thegreenplace.net/feeds/all.atom.xml"),("type","application/atom+xml"),("rel","alternate"),("title","Eli Bendersky's website ATOM Feed")],TagClose "link",TagText "\n\n",TagClose "head",TagText "\n",TagOpen "body" [],TagText "\n\n",TagOpen "div" [("class","navbar navbar-default navbar-fixed-top"),("role","navigation")],TagText "\n    ",TagOpen "div" [("class","container")],TagText "\n        ",TagOpen "div" [("class","navbar-header")],TagText "\n            ",TagOpen "button" [("type","button"),("class","navbar-toggle"),("data-toggle","collapse"),("data-target",".navbar-ex1-collapse")],TagText "\n                ",TagOpen "span" [("class","sr-only")],TagText "Toggle navigation",TagClose "span",TagText "\n                ",TagOpen "span" [("class","icon-bar")],TagClose "span",TagText "\n                ",TagOpen "span" [("class","icon-bar")],TagClose "span",TagText "\n                ",TagOpen "span" [("class","icon-bar")],TagClose "span",TagText "\n            ",TagClose "button",TagText "\n            ",TagOpen "a" [("href","https://eli.thegreenplace.net/"),("class","navbar-brand")],TagText "\n                ",TagOpen "img" [("src","https://eli.thegreenplace.net/images/logosmall.png"),("width","32"),("height","32")],TagClose "img",TagText "\nEli Bendersky's website            ",TagClose "a",TagText "\n        ",TagClose "div",TagText "\n        ",TagOpen "div" [("class","collapse navbar-collapse navbar-ex1-collapse")],TagText "\n            ",TagOpen "ul" [("class","nav navbar-nav navbar-right")],TagText "\n                ",TagOpen "li" [],TagText "\n                    ",TagOpen "a" [("href","https://eli.thegreenplace.net/pages/about")],TagText "\n                        ",TagOpen "i" [("class","fa fa-question")],TagClose "i",TagText "\n                        ",TagOpen "span" [("class","icon-label")],TagText "About",TagClose "span",TagText "\n                    ",TagClose "a",TagText "\n                ",TagClose "li",TagText "\n                ",TagOpen "li" [],TagText "\n                    ",TagOpen "a" [("href","https://eli.thegreenplace.net/pages/projects")],TagText "\n                        ",TagOpen "i" [("class","fa fa-github")],TagClose "i",TagText "\n                        ",TagOpen "span" [("class","icon-label")],TagText "Projects",TagClose "span",TagText "\n                    ",TagClose "a",TagText "\n                ",TagClose "li",TagText "\n                ",TagOpen "li" [],TagText "\n                    ",TagOpen "a" [("href","https://eli.thegreenplace.net/archives/all")],TagText "\n                        ",TagOpen "i" [("class","fa fa-th-list")],TagClose "i",TagText "\n                        ",TagOpen "span" [("class","icon-label")],TagText "Archives",TagClose "span",TagText "\n                    ",TagClose "a",TagText "\n                ",TagClose "li",TagText "\n            ",TagClose "ul",TagText "\n        ",TagClose "div",TagText "\n        ",TagComment " /.navbar-collapse ",TagText "\n    ",TagClose "div",TagText "\n",TagClose "div",TagText " ",TagComment " /.navbar ",TagText "\n\n",TagOpen "div" [("class","container")],TagText "\n    ",TagOpen "div" [("class","row")],TagText "\n    ",TagOpen "section" [("id","content")],TagText "\n        ",TagOpen "article" [],TagText "\n            ",TagOpen "header" [("class","page-header")],TagText "\n                ",TagOpen "h1" [],TagText "\n                    ",TagOpen "a" [("href","https://eli.thegreenplace.net/2018/type-erasure-and-reification/"),("rel","bookmark"),("title","Permalink to Type erasure and reification")],TagText "\n                        Type erasure and reification\n                    ",TagClose "a",TagText "\n                ",TagClose "h1",TagText "\n            ",TagClose "header",TagText "\n            ",TagOpen "div" [("class","entry-content")],TagText "\n                ",TagOpen "div" [("class","panel")],TagText "\n                    ",TagOpen "div" [("class","panel-body")],TagText "\n",TagOpen "footer" [("class","post-info")],TagText "\n    ",TagOpen "span" [("class","published")],TagText "\n        ",TagOpen "i" [("class","fa fa-calendar")],TagClose "i",TagText "\n        ",TagOpen "time" [],TagText " December 05, 2018 at 05:10",TagClose "time",TagText "\n    ",TagClose "span",TagText "\n",TagOpen "span" [("class","label label-default")],TagText "Tags",TagClose "span",TagText "\n    ",TagOpen "a" [("href","https://eli.thegreenplace.net/tag/programming")],TagText "Programming",TagClose "a",TagText "\n        ,\n    ",TagOpen "a" [("href","https://eli.thegreenplace.net/tag/c-c")],TagText "C & C++",TagClose "a",TagText "\n        ,\n    ",TagOpen "a" [("href","https://eli.thegreenplace.net/tag/python")],TagText "Python",TagClose "a",TagText "\n",TagClose "footer",TagComment " /.post-info ",TagText "                    ",TagClose "div",TagText "\n                ",TagClose "div",TagText "\n                ",TagOpen "p" [],TagText "In this post I'd like to discuss the concepts of ",TagOpen "em" [],TagText "type erasure",TagClose "em",TagText " and\n",TagOpen "em" [],TagText "reification",TagClose "em",TagText " in programming languages. I don't intend to dive very deeply into\nthe specific rules of any particular language; rather, the post is going to\npresent several simple examples in multiple languages, hoping to provide enough\nintuition and background for a more serious study, if necessary. As you'll\nsee, the actual concepts are very simple and familiar. Deeper details of\nspecific languages pertain more to the idiosyncrasies of those languages'\nsemantics and implementations.",TagClose "p",TagText "\n",TagOpen "p" [],TagText "Important note: in C++ there is a programming pattern called ",TagOpen "em" [],TagText "type erasure",TagClose "em",TagText ",\nwhich is quite distinct from what I'm trying to describe here ",TagOpen "a" [("class","footnote-reference"),("href","#footnote-1"),("id","footnote-reference-1")],TagText "[1]",TagClose "a",TagText ". I'll be\nusing C++ examples here, but that's to demonstrate how the original concepts\napply in C++. The programming pattern will be covered in a separate post.",TagClose "p",TagText "\n",TagOpen "div" [("class","section"),("id","types-at-compile-time-no-types-at-run-time")],TagText "\n",TagOpen "h2" [],TagText "Types at compile time, no types at run-time",TagClose "h2",TagText "\n",TagOpen "p" [],TagText "The title of this section is a \"one short sentence\" explanation of what type\nerasure means. With few exceptions, it only applies to languages with some\ndegree of compile time (a.k.a. ",TagOpen "em" [],TagText "static",TagClose "em",TagText ") type checking. The basic principle\nshould be immediately familiar to folks who have some idea of what machine code\ngenerated from low-level languages like C looks like. While C has static typing,\nthis only matters in the compiler - the generated code is completely oblivious\nto types.",TagClose "p",TagText "\n",TagOpen "p" [],TagText "For example, consider the following C snippet:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","k")],TagText "typedef",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "struct",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nc")],TagText "Frob_t",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "x",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "y",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "arr",TagClose "span",TagOpen "span" [("class","p")],TagText "[",TagClose "span",TagOpen "span" [("class","mi")],TagText "10",TagClose "span",TagOpen "span" [("class","p")],TagText "];",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "Frob",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "extract",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "Frob",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","k")],TagText "return",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","o")],TagText "->",TagClose "span",TagOpen "span" [("class","n")],TagText "y",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","o")],TagText "->",TagClose "span",TagOpen "span" [("class","n")],TagText "arr",TagClose "span",TagOpen "span" [("class","p")],TagText "[",TagClose "span",TagOpen "span" [("class","mi")],TagText "7",TagClose "span",TagOpen "span" [("class","p")],TagText "];",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "When compiling the function ",TagOpen "tt" [("class","docutils literal")],TagText "extract",TagClose "tt",TagText ", the compiler will perform type\nchecking. It won't let us access fields that were not declared in the struct,\nfor example. Neither will it let us pass a pointer to a different struct (or to\na ",TagOpen "tt" [("class","docutils literal")],TagText "float",TagClose "tt",TagText ") into ",TagOpen "tt" [("class","docutils literal")],TagText "extract",TagClose "tt",TagText ". But once it's done helping us, the compiler\ngenerates code which is completely type-free:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagText "0:   8b 47 04                mov    0x4(%rdi),%eax\n3:   0f af 47 24             imul   0x24(%rdi),%eax\n7:   c3                      retq\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "The compiler is familiar with the ",TagOpen "a" [("class","reference external"),("href","https://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64/")],TagText "stack frame layout",TagClose "a",TagText " and\nother specifics of the ABI, and generates code that assumes a correct type of\nstructure was passed in. If the actual type is not what this function expects,\nthere will be trouble (either accessing unmapped memory, or accessing wrong\ndata).",TagClose "p",TagText "\n",TagOpen "p" [],TagText "A slightly adjusted example will clarify this:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "extract_cast",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "p",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "Frob",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "p",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","k")],TagText "return",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","o")],TagText "->",TagClose "span",TagOpen "span" [("class","n")],TagText "y",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "frob",TagClose "span",TagOpen "span" [("class","o")],TagText "->",TagClose "span",TagOpen "span" [("class","n")],TagText "arr",TagClose "span",TagOpen "span" [("class","p")],TagText "[",TagClose "span",TagOpen "span" [("class","mi")],TagText "7",TagClose "span",TagOpen "span" [("class","p")],TagText "];",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "The compiler will generate exactly identical code from this function, which in\nitself a good indication of when the types matter and when they don't. What's\nmore interesting is that ",TagOpen "tt" [("class","docutils literal")],TagText "extract_cast",TagClose "tt",TagText " makes it extremely easy for\nprogrammers to shoot themselves in the foot:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","n")],TagText "SomeOtherStruct",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "ss",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","n")],TagText "extract_cast",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","o")],TagText "&",TagClose "span",TagOpen "span" [("class","n")],TagText "ss",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","c1")],TagText "// oops",TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "In general, ",TagOpen "em" [],TagText "type erasure",TagClose "em",TagText " is a concept that descibes these semantics of a\nlanguage. Types matter to the compiler, which uses them to generate code and\nhelp the programmer avoid errors. Once everything is type-checked, however, the\ntypes are simply ",TagOpen "em" [],TagText "erased",TagClose "em",TagText " and the code the compiler generates is oblivious to\nthem. The next section will put this in context by comparing to the opposite\napproach.",TagClose "p",TagText "\n",TagClose "div",TagText "\n",TagOpen "div" [("class","section"),("id","reification-retaining-types-at-run-time")],TagText "\n",TagOpen "h2" [],TagText "Reification - retaining types at run-time",TagClose "h2",TagText "\n",TagOpen "p" [],TagText "While erasure means the compiler discards all type information for the actual\ngenerated code, ",TagOpen "em" [],TagText "reification",TagClose "em",TagText " is the other way to go - types are retained at\nrun-time and used for perform various checks. A classical example from Java will\nhelp demonstrate this:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","kd")],TagText "class",TagClose "span",TagText " ",TagOpen "span" [("class","nc")],TagText "Main",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kd")],TagText "public",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kd")],TagText "static",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "main",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","o")],TagText "[]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "args",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "strings",TagClose "span",TagOpen "span" [("class","o")],TagText "[]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","s")],TagText "\"a\"",TagClose "span",TagOpen "span" [("class","p")],TagText ",",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","s")],TagText "\"b\"",TagClose "span",TagOpen "span" [("class","p")],TagText "};",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "Object",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "objects",TagClose "span",TagOpen "span" [("class","o")],TagText "[]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "strings",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "objects",TagClose "span",TagOpen "span" [("class","o")],TagText "[",TagClose "span",TagOpen "span" [("class","mi")],TagText "0",TagClose "span",TagOpen "span" [("class","o")],TagText "]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","mi")],TagText "5",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "This code creates an array of ",TagOpen "tt" [("class","docutils literal")],TagText "String",TagClose "tt",TagText ", and converts it to a generic array of\n",TagOpen "tt" [("class","docutils literal")],TagText "Object",TagClose "tt",TagText ". This is valid because arrays in Java\n",TagOpen "a" [("class","reference external"),("href","https://eli.thegreenplace.net/2018/covariance-and-contravariance-in-subtyping/")],TagText "are covariant",TagClose "a",TagText ",\nso the compiler doesn't complain. However, in the next line we try to assign\nan integer into the array. This happens to fail with an exception ",TagOpen "em" [],TagText "at run-time",TagClose "em",TagText ":",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagText "Exception in thread \"main\" java.lang.ArrayStoreException: java.lang.Integer\n    at Main.main(Main.java:5)\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "A type check was inserted into the generated code, and it fired when an\nincorrect assignment was attempted. In other words, the type of ",TagOpen "tt" [("class","docutils literal")],TagText "objects",TagClose "tt",TagText " is\n",TagOpen "em" [],TagText "reified",TagClose "em",TagText ". Reification is defined roughly as \"taking something abstract and\nmaking it real/concrete\", which when applied to types means \"compile-time types\nare converted to actual run-time entities\".",TagClose "p",TagText "\n",TagOpen "p" [],TagText "C++ has some type reification support as well, e.g. with ",TagOpen "tt" [("class","docutils literal")],TagText "dynamic_cast",TagClose "tt",TagText ":",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","k")],TagText "struct",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nc")],TagText "Base",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","k")],TagText "virtual",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "basefunc",TagClose "span",TagOpen "span" [("class","p")],TagText "()",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "printf",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","s")],TagText "\"basefunc",TagClose "span",TagOpen "span" [("class","se")],TagText "\\n",TagClose "span",TagOpen "span" [("class","s")],TagText "\"",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "};",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","k")],TagText "struct",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nc")],TagText "Derived",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText ":",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "public",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "Base",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "derivedfunc",TagClose "span",TagOpen "span" [("class","p")],TagText "()",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "printf",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","s")],TagText "\"derived",TagClose "span",TagOpen "span" [("class","se")],TagText "\\n",TagClose "span",TagOpen "span" [("class","s")],TagText "\"",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "};",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "call_derived",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "Base",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "b",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "Derived",TagClose "span",TagOpen "span" [("class","o")],TagText "*",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "d",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "dynamic_cast",TagClose "span",TagOpen "span" [("class","o")],TagText "<",TagClose "span",TagOpen "span" [("class","n")],TagText "Derived",TagClose "span",TagOpen "span" [("class","o")],TagText "*>",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "b",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","k")],TagText "if",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "d",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "!=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "nullptr",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "d",TagClose "span",TagOpen "span" [("class","o")],TagText "->",TagClose "span",TagOpen "span" [("class","n")],TagText "derivedfunc",TagClose "span",TagOpen "span" [("class","p")],TagText "();",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "else",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "printf",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","s")],TagText "\"cast failed",TagClose "span",TagOpen "span" [("class","se")],TagText "\\n",TagClose "span",TagOpen "span" [("class","s")],TagText "\"",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "We can call ",TagOpen "tt" [("class","docutils literal")],TagText "call_derived",TagClose "tt",TagText " thus:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","kt")],TagText "int",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "main",TagClose "span",TagOpen "span" [("class","p")],TagText "()",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "Derived",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "d",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "call_derived",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","o")],TagText "&",TagClose "span",TagOpen "span" [("class","n")],TagText "d",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "Base",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "b",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","n")],TagText "call_derived",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","o")],TagText "&",TagClose "span",TagOpen "span" [("class","n")],TagText "b",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "The first call will successfully invoke ",TagOpen "tt" [("class","docutils literal")],TagText "derivedfunc",TagClose "tt",TagText "; the second will not,\nbecause the ",TagOpen "tt" [("class","docutils literal")],TagText "dynamic_cast",TagClose "tt",TagText " will return ",TagOpen "tt" [("class","docutils literal")],TagText "nullptr",TagClose "tt",TagText " at run-time. This is\nbecause we're using C++'s ",TagOpen "em" [],TagText "run-time type information",TagClose "em",TagText " (RTTI) capabilities here,\nwhere an actual representation of the type is stored in the generated code (most\nlikely attached to the vtable which every polymorphic object points to). C++\nalso has the ",TagOpen "tt" [("class","docutils literal")],TagText "typeid",TagClose "tt",TagText " feature, but I'm showing ",TagOpen "tt" [("class","docutils literal")],TagText "dynamic_cast",TagClose "tt",TagText " since it's the\none most commonly used.",TagClose "p",TagText "\n",TagOpen "p" [],TagText "Note particularly the differences between this sample and the C sample in the\nbeginning of the post. Conceptually, it's similar - we use a pointer to a\ngeneral type (in C that's ",TagOpen "tt" [("class","docutils literal")],TagText "void*",TagClose "tt",TagText ", in the C++ example we use a base type) to\ninteract with concrete types. Whereas in C there is no built-in run-time type\nfeature, in C++ we can use RTTI in some cases. With RTTI enabled,\n",TagOpen "tt" [("class","docutils literal")],TagText "dynamic_cast",TagClose "tt",TagText " can be used to interact with the run-time (reified)\nrepresentation of types in a limited but useful way.",TagClose "p",TagText "\n",TagClose "div",TagText "\n",TagOpen "div" [("class","section"),("id","type-erasure-and-java-generics")],TagText "\n",TagOpen "h2" [],TagText "Type erasure and Java generics",TagClose "h2",TagText "\n",TagOpen "p" [],TagText "One place where folks not necessarily familiar with programming language type\ntheory encounter erasure is Java generics, which were bolted onto the language\nafter a large amount of code has already been written. The designers of Java\nfaced the binary compatibility challenge, wherein they wanted code compiled with\nnewer Java compilers to run on older VMs.",TagClose "p",TagText "\n",TagOpen "p" [],TagText "The solution was to use type erasure to implement generics entirely in the\ncompiler. Here's a quote from the ",TagOpen "a" [("class","reference external"),("href","https://docs.oracle.com/javase/tutorial/java/generics/erasure.html")],TagText "official Java generics tutorial",TagClose "a",TagText ":",TagClose "p",TagText "\n",TagOpen "blockquote" [],TagText "\n",TagOpen "p" [],TagText "Generics were introduced to the Java language to provide tighter type checks\nat compile time and to support generic programming. To implement generics, the\nJava compiler applies type erasure to:",TagClose "p",TagText "\n",TagOpen "ul" [("class","simple")],TagText "\n",TagOpen "li" [],TagText "Replace all type parameters in generic types with their bounds or Object if\nthe type parameters are unbounded. The produced bytecode, therefore,\ncontains only ordinary classes, interfaces, and methods.",TagClose "li",TagText "\n",TagOpen "li" [],TagText "Insert type casts if necessary to preserve type safety.",TagClose "li",TagText "\n",TagOpen "li" [],TagText "Generate bridge methods to preserve polymorphism in extended generic types.",TagClose "li",TagText "\n",TagClose "ul",TagText "\n",TagClose "blockquote",TagText "\n",TagOpen "p" [],TagText "Here's a very simple example to demonstrate what's going on, taken from\n",TagOpen "a" [("class","reference external"),("href","https://stackoverflow.com/a/339708/8206")],TagText "a Stack Overflow answer",TagClose "a",TagText ". This code:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","kn")],TagText "import",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nn")],TagText "java.util.List",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","kn")],TagText "import",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nn")],TagText "java.util.ArrayList",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","kd")],TagText "class",TagClose "span",TagText " ",TagOpen "span" [("class","nc")],TagText "Main",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kd")],TagText "public",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kd")],TagText "static",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "main",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","o")],TagText "[]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "args",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "List",TagClose "span",TagOpen "span" [("class","o")],TagText "<",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","o")],TagText ">",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "new",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "ArrayList",TagClose "span",TagOpen "span" [("class","o")],TagText "<",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","o")],TagText ">",TagClose "span",TagOpen "span" [("class","p")],TagText "();",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "add",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","s")],TagText "\"Hi\"",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "x",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "get",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","mi")],TagText "0",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "System",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "out",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "println",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "x",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "Uses a generic ",TagOpen "tt" [("class","docutils literal")],TagText "List",TagClose "tt",TagText ". However, what the compiler creates prior to emitting\nbytecode is equivalent to:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","kn")],TagText "import",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nn")],TagText "java.util.List",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","kn")],TagText "import",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nn")],TagText "java.util.ArrayList",TagClose "span",TagOpen "span" [("class","p")],TagText ";",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n\n",TagOpen "span" [("class","kd")],TagText "class",TagClose "span",TagText " ",TagOpen "span" [("class","nc")],TagText "Main",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","kd")],TagText "public",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kd")],TagText "static",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","kt")],TagText "void",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","nf")],TagText "main",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","o")],TagText "[]",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "args",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "{",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "List",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","k")],TagText "new",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "ArrayList",TagClose "span",TagOpen "span" [("class","p")],TagText "();",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "add",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","s")],TagText "\"Hi\"",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "x",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "String",TagClose "span",TagOpen "span" [("class","p")],TagText ")",TagClose "span",TagOpen "span" [("class","w")],TagText " ",TagClose "span",TagOpen "span" [("class","n")],TagText "list",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "get",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","mi")],TagText "0",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "    ",TagClose "span",TagOpen "span" [("class","n")],TagText "System",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "out",TagClose "span",TagOpen "span" [("class","p")],TagText ".",TagClose "span",TagOpen "span" [("class","na")],TagText "println",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","n")],TagText "x",TagClose "span",TagOpen "span" [("class","p")],TagText ");",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","w")],TagText "  ",TagClose "span",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagOpen "span" [("class","p")],TagText "}",TagClose "span",TagOpen "span" [("class","w")],TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "Here ",TagOpen "tt" [("class","docutils literal")],TagText "List",TagClose "tt",TagText " is a container of ",TagOpen "tt" [("class","docutils literal")],TagText "Object",TagClose "tt",TagText ", so we can assign any element to it\n(similarly to the reification example shown in the previous section). The\ncompiler then inserts a cast when accessing that element as a string. In this\ncase the compiler will adamantly preserve type safety and won't let us do\n",TagOpen "tt" [("class","docutils literal")],TagText "list.add(5)",TagClose "tt",TagText " in the original snippet, because it sees that ",TagOpen "tt" [("class","docutils literal")],TagText "list",TagClose "tt",TagText " is a\n",TagOpen "tt" [("class","docutils literal")],TagText "List<String>",TagClose "tt",TagText ". Therefore, the cast to ",TagOpen "tt" [("class","docutils literal")],TagText "(String)",TagClose "tt",TagText " should be safe.",TagClose "p",TagText "\n",TagOpen "p" [],TagText "Using type erasure to implement generics with backwards compatibility is a neat\nidea, but it has its issues. Some folks complain that not having the types\navailable at runtime is a limitation (e.g. not being able to use ",TagOpen "tt" [("class","docutils literal")],TagText "instanceof",TagClose "tt",TagText "\nand other reflection capabilities). Other languages, like C# and Dart 2, have\n",TagOpen "em" [],TagText "reified generics",TagClose "em",TagText " which do preserve the type information at run-time.",TagClose "p",TagText "\n",TagClose "div",TagText "\n",TagOpen "div" [("class","section"),("id","reification-in-dynamically-typed-languages")],TagText "\n",TagOpen "h2" [],TagText "Reification in dynamically typed languages",TagClose "h2",TagText "\n",TagOpen "p" [],TagText "I hope it's obvious that the theory and techniques described above only apply\nto statically-typed languages. In dynamically-typed languages, like Python,\nthere is almost no concept of types at compile-time, and types are a fully\nreified concept. Even trivial errors like:",TagClose "p",TagText "\n",TagOpen "div" [("class","highlight")],TagOpen "pre" [],TagOpen "span" [],TagClose "span",TagOpen "span" [("class","k")],TagText "class",TagClose "span",TagText " ",TagOpen "span" [("class","nc")],TagText "Foo",TagClose "span",TagOpen "span" [("class","p")],TagText ":",TagClose "span",TagText "\n  ",TagOpen "span" [("class","k")],TagText "def",TagClose "span",TagText " ",TagOpen "span" [("class","nf")],TagText "bar",TagClose "span",TagOpen "span" [("class","p")],TagText "(",TagClose "span",TagOpen "span" [("class","bp")],TagText "self",TagClose "span",TagOpen "span" [("class","p")],TagText "):",TagClose "span",TagText " ",TagOpen "span" [("class","k")],TagText "pass",TagClose "span",TagText "\n\n",TagOpen "span" [("class","n")],TagText "f",TagClose "span",TagText " ",TagOpen "span" [("class","o")],TagText "=",TagClose "span",TagText " ",TagOpen "span" [("class","n")],TagText "Foo",TagClose "span",TagOpen "span" [("class","p")],TagText "()",TagClose "span",TagText "\n",TagOpen "span" [("class","n")],TagText "f",TagClose "span",TagOpen "span" [("class","o")],TagText ".",TagClose "span",TagOpen "span" [("class","n")],TagText "joe",TagClose "span",TagOpen "span" [("class","p")],TagText "()",TagClose "span",TagText "         ",TagOpen "span" [("class","c1")],TagText "# <--- calling non-existent method",TagClose "span",TagText "\n",TagClose "pre",TagClose "div",TagText "\n",TagOpen "p" [],TagText "Fire at run-time, because there's no static type checking ",TagOpen "a" [("class","footnote-reference"),("href","#footnote-2"),("id","footnote-reference-2")],TagText "[2]",TagClose "a",TagText ". Types obviously\nexist at run-time, with functions like ",TagOpen "tt" [("class","docutils literal")],TagText "type()",TagClose "tt",TagText " and ",TagOpen "tt" [("class","docutils literal")],TagText "isinstance()",TagClose "tt",TagText " providing\ncomplete reflection capabilities. The ",TagOpen "tt" [("class","docutils literal")],TagText "type()",TagClose "tt",TagText " function can even create new\ntypes ",TagOpen "a" [("class","reference external"),("href","https://eli.thegreenplace.net/2012/04/16/python-object-creation-sequence")],TagText "entirely at run-time",TagClose "a",TagText ".",TagClose "p",TagText "\n",TagOpen "hr" [("class","docutils")],TagClose "hr",TagText "\n",TagOpen "table" [("class","docutils footnote"),("frame","void"),("id","footnote-1"),("rules","none")],TagText "\n",TagOpen "colgroup" [],TagOpen "col" [("class","label")],TagClose "col",TagOpen "col" [],TagClose "col",TagClose "colgroup",TagText "\n",TagOpen "tbody" [("valign","top")],TagText "\n",TagOpen "tr" [],TagOpen "td" [("class","label")],TagOpen "a" [("class","fn-backref"),("href","#footnote-reference-1")],TagText "[1]",TagClose "a",TagClose "td",TagOpen "td" [],TagText "But it's most likely what you'll get to if you google for\n\"c++ type erasure\".",TagClose "td",TagClose "tr",TagText "\n",TagClose "tbody",TagText "\n",TagClose "table",TagText "\n",TagOpen "table" [("class","docutils footnote"),("frame","void"),("id","footnote-2"),("rules","none")],TagText "\n",TagOpen "colgroup" [],TagOpen "col" [("class","label")],TagClose "col",TagOpen "col" [],TagClose "col",TagClose "colgroup",TagText "\n",TagOpen "tbody" [("valign","top")],TagText "\n",TagOpen "tr" [],TagOpen "td" [("class","label")],TagOpen "a" [("class","fn-backref"),("href","#footnote-reference-2")],TagText "[2]",TagClose "a",TagClose "td",TagOpen "td" [],TagText "To be clear - this is not a bug; it's a feature of Python. A new method\ncan be added to classes dynamically at runtime (here, some code could\nhave defined a ",TagOpen "tt" [("class","docutils literal")],TagText "joe",TagClose "tt",TagText " method for ",TagOpen "tt" [("class","docutils literal")],TagText "Foo",TagClose "tt",TagText " before the ",TagOpen "tt" [("class","docutils literal")],TagText "f.joe()",TagClose "tt",TagText "\ninvocation), and the compiler has absolutely no way of knowing this could\nor couldn't happen. So it has to assume such invocations are valid and\nrely on run-time checking to avoid serious errors like memory corruption.",TagClose "td",TagClose "tr",TagText "\n",TagClose "tbody",TagText "\n",TagClose "table",TagText "\n",TagClose "div",TagText "\n\n            ",TagClose "div",TagText "\n            ",TagComment " /.entry-content ",TagText "\n",TagOpen "hr" [],TagClose "hr",TagText "\n",TagOpen "div" [("class","dotted-links")],TagText "\n",TagOpen "p" [("class","align-center")],TagText "\nFor comments, please send me\n",TagOpen "a" [("href","mailto:eliben@gmail.com")],TagOpen "i" [("class","fa fa-envelope-o")],TagClose "i",TagText " an email",TagClose "a",TagText ".\n",TagClose "p",TagText "\n",TagClose "div",TagText "        ",TagClose "article",TagText "\n    ",TagClose "section",TagText "\n\n    ",TagClose "div",TagText "\n",TagClose "div",TagText "\n",TagOpen "footer" [],TagText "\n   ",TagOpen "div" [("class","container")],TagText "\n      ",TagOpen "hr" [],TagText "\n      ",TagOpen "div" [("class","row")],TagText "\n         ",TagOpen "div" [("class","col-xs-10")],TagText "\n            \169 2003-2024 Eli Bendersky\n         ",TagClose "div",TagText "\n         ",TagOpen "div" [("class","col-xs-2")],TagOpen "p" [("class","pull-right")],TagOpen "i" [("class","fa fa-arrow-up")],TagClose "i",TagText " ",TagOpen "a" [("href","#")],TagText "Back to top",TagClose "a",TagClose "p",TagClose "div",TagText "\n      ",TagClose "div",TagText "\n   ",TagClose "div",TagText "\n",TagClose "footer",TagText "\n",TagOpen "script" [("src","//code.jquery.com/jquery-2.2.4.min.js")],TagClose "script",TagText "\n\n",TagComment " Include all compiled plugins (below), or include individual files as needed ",TagText "\n",TagOpen "script" [("src","https://eli.thegreenplace.net/theme/js/bootstrap.min.js")],TagClose "script",TagText "\n\n",TagComment "\n  Using goatcounter to count visitors. The count.js script is vendored in.\n",TagText "\n",TagOpen "script" [("data-goatcounter","https://stats.thegreenplace.net/count"),("async",""),("src","https://eli.thegreenplace.net/theme/js/count.js")],TagClose "script",TagText "\n",TagClose "body",TagText "\n",TagClose "html"]