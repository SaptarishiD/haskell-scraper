"\n\n<div class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\">\n    <div class=\"container\">\n        <div class=\"navbar-header\">\n            <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-ex1-collapse\">\n                <span class=\"sr-only\">Toggle navigation</span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n                <span class=\"icon-bar\"></span>\n            </button>\n            <a href=\"https://eli.thegreenplace.net/\" class=\"navbar-brand\">\n                <img src=\"https://eli.thegreenplace.net/images/logosmall.png\" width=\"32\" height=\"32\"></img>\nEli Bendersky&#39;s website            </a>\n        </div>\n        <div class=\"collapse navbar-collapse navbar-ex1-collapse\">\n            <ul class=\"nav navbar-nav navbar-right\">\n                <li>\n                    <a href=\"https://eli.thegreenplace.net/pages/about\">\n                        <i class=\"fa fa-question\"></i>\n                        <span class=\"icon-label\">About</span>\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://eli.thegreenplace.net/pages/projects\">\n                        <i class=\"fa fa-github\"></i>\n                        <span class=\"icon-label\">Projects</span>\n                    </a>\n                </li>\n                <li>\n                    <a href=\"https://eli.thegreenplace.net/archives/all\">\n                        <i class=\"fa fa-th-list\"></i>\n                        <span class=\"icon-label\">Archives</span>\n                    </a>\n                </li>\n            </ul>\n        </div>\n        <!-- /.navbar-collapse -->\n    </div>\n</div> <!-- /.navbar -->\n\n<div class=\"container\">\n    <div class=\"row\">\n    <section id=\"content\">\n        <article>\n            <header class=\"page-header\">\n                <h1>\n                    <a href=\"https://eli.thegreenplace.net/2018/type-erasure-and-reification/\" rel=\"bookmark\" title=\"Permalink to Type erasure and reification\">\n                        Type erasure and reification\n                    </a>\n                </h1>\n            </header>\n            <div class=\"entry-content\">\n                <div class=\"panel\">\n                    <div class=\"panel-body\">\n<footer class=\"post-info\">\n    <span class=\"published\">\n        <i class=\"fa fa-calendar\"></i>\n        <time> December 05, 2018 at 05:10</time>\n    </span>\n<span class=\"label label-default\">Tags</span>\n    <a href=\"https://eli.thegreenplace.net/tag/programming\">Programming</a>\n        ,\n    <a href=\"https://eli.thegreenplace.net/tag/c-c\">C &amp; C++</a>\n        ,\n    <a href=\"https://eli.thegreenplace.net/tag/python\">Python</a>\n</footer><!-- /.post-info -->                    </div>\n                </div>\n                <p>In this post I&#39;d like to discuss the concepts of <em>type erasure</em> and\n<em>reification</em> in programming languages. I don&#39;t intend to dive very deeply into\nthe specific rules of any particular language; rather, the post is going to\npresent several simple examples in multiple languages, hoping to provide enough\nintuition and background for a more serious study, if necessary. As you&#39;ll\nsee, the actual concepts are very simple and familiar. Deeper details of\nspecific languages pertain more to the idiosyncrasies of those languages&#39;\nsemantics and implementations.</p>\n<p>Important note: in C++ there is a programming pattern called <em>type erasure</em>,\nwhich is quite distinct from what I&#39;m trying to describe here <a class=\"footnote-reference\" href=\"#footnote-1\" id=\"footnote-reference-1\">[1]</a>. I&#39;ll be\nusing C++ examples here, but that&#39;s to demonstrate how the original concepts\napply in C++. The programming pattern will be covered in a separate post.</p>\n<div class=\"section\" id=\"types-at-compile-time-no-types-at-run-time\">\n<h2>Types at compile time, no types at run-time</h2>\n<p>The title of this section is a &quot;one short sentence&quot; explanation of what type\nerasure means. With few exceptions, it only applies to languages with some\ndegree of compile time (a.k.a. <em>static</em>) type checking. The basic principle\nshould be immediately familiar to folks who have some idea of what machine code\ngenerated from low-level languages like C looks like. While C has static typing,\nthis only matters in the compiler - the generated code is completely oblivious\nto types.</p>\n<p>For example, consider the following C snippet:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"k\">typedef</span><span class=\"w\"> </span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Frob_t</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"n\">arr</span><span class=\"p\">[</span><span class=\"mi\">10</span><span class=\"p\">];</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"> </span><span class=\"n\">Frob</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">extract</span><span class=\"p\">(</span><span class=\"n\">Frob</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"o\">-&gt;</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"o\">-&gt;</span><span class=\"n\">arr</span><span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">];</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>When compiling the function <tt class=\"docutils literal\">extract</tt>, the compiler will perform type\nchecking. It won&#39;t let us access fields that were not declared in the struct,\nfor example. Neither will it let us pass a pointer to a different struct (or to\na <tt class=\"docutils literal\">float</tt>) into <tt class=\"docutils literal\">extract</tt>. But once it&#39;s done helping us, the compiler\ngenerates code which is completely type-free:</p>\n<div class=\"highlight\"><pre><span></span>0:   8b 47 04                mov    0x4(%rdi),%eax\n3:   0f af 47 24             imul   0x24(%rdi),%eax\n7:   c3                      retq\n</pre></div>\n<p>The compiler is familiar with the <a class=\"reference external\" href=\"https://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64/\">stack frame layout</a> and\nother specifics of the ABI, and generates code that assumes a correct type of\nstructure was passed in. If the actual type is not what this function expects,\nthere will be trouble (either accessing unmapped memory, or accessing wrong\ndata).</p>\n<p>A slightly adjusted example will clarify this:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">extract_cast</span><span class=\"p\">(</span><span class=\"kt\">void</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Frob</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">p</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"o\">-&gt;</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">frob</span><span class=\"o\">-&gt;</span><span class=\"n\">arr</span><span class=\"p\">[</span><span class=\"mi\">7</span><span class=\"p\">];</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>The compiler will generate exactly identical code from this function, which in\nitself a good indication of when the types matter and when they don&#39;t. What&#39;s\nmore interesting is that <tt class=\"docutils literal\">extract_cast</tt> makes it extremely easy for\nprogrammers to shoot themselves in the foot:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"n\">SomeOtherStruct</span><span class=\"w\"> </span><span class=\"n\">ss</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"n\">extract_cast</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">ss</span><span class=\"p\">);</span><span class=\"w\">    </span><span class=\"c1\">// oops</span>\n</pre></div>\n<p>In general, <em>type erasure</em> is a concept that descibes these semantics of a\nlanguage. Types matter to the compiler, which uses them to generate code and\nhelp the programmer avoid errors. Once everything is type-checked, however, the\ntypes are simply <em>erased</em> and the code the compiler generates is oblivious to\nthem. The next section will put this in context by comparing to the opposite\napproach.</p>\n</div>\n<div class=\"section\" id=\"reification-retaining-types-at-run-time\">\n<h2>Reification - retaining types at run-time</h2>\n<p>While erasure means the compiler discards all type information for the actual\ngenerated code, <em>reification</em> is the other way to go - types are retained at\nrun-time and used for perform various checks. A classical example from Java will\nhelp demonstrate this:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kd\">class</span> <span class=\"nc\">Main</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kd\">public</span><span class=\"w\"> </span><span class=\"kd\">static</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">strings</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"s\">&quot;a&quot;</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">&quot;b&quot;</span><span class=\"p\">};</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">Object</span><span class=\"w\"> </span><span class=\"n\">objects</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">strings</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">objects</span><span class=\"o\">[</span><span class=\"mi\">0</span><span class=\"o\">]</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">5</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>This code creates an array of <tt class=\"docutils literal\">String</tt>, and converts it to a generic array of\n<tt class=\"docutils literal\">Object</tt>. This is valid because arrays in Java\n<a class=\"reference external\" href=\"https://eli.thegreenplace.net/2018/covariance-and-contravariance-in-subtyping/\">are covariant</a>,\nso the compiler doesn&#39;t complain. However, in the next line we try to assign\nan integer into the array. This happens to fail with an exception <em>at run-time</em>:</p>\n<div class=\"highlight\"><pre><span></span>Exception in thread &quot;main&quot; java.lang.ArrayStoreException: java.lang.Integer\n    at Main.main(Main.java:5)\n</pre></div>\n<p>A type check was inserted into the generated code, and it fired when an\nincorrect assignment was attempted. In other words, the type of <tt class=\"docutils literal\">objects</tt> is\n<em>reified</em>. Reification is defined roughly as &quot;taking something abstract and\nmaking it real/concrete&quot;, which when applied to types means &quot;compile-time types\nare converted to actual run-time entities&quot;.</p>\n<p>C++ has some type reification support as well, e.g. with <tt class=\"docutils literal\">dynamic_cast</tt>:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Base</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">virtual</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">basefunc</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;basefunc</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">};</span><span class=\"w\"></span>\n\n<span class=\"k\">struct</span><span class=\"w\"> </span><span class=\"nc\">Derived</span><span class=\"w\"> </span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"k\">public</span><span class=\"w\"> </span><span class=\"n\">Base</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">derivedfunc</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;derived</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">};</span><span class=\"w\"></span>\n\n<span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">call_derived</span><span class=\"p\">(</span><span class=\"n\">Base</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Derived</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">dynamic_cast</span><span class=\"o\">&lt;</span><span class=\"n\">Derived</span><span class=\"o\">*&gt;</span><span class=\"p\">(</span><span class=\"n\">b</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">d</span><span class=\"w\"> </span><span class=\"o\">!=</span><span class=\"w\"> </span><span class=\"k\">nullptr</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">d</span><span class=\"o\">-&gt;</span><span class=\"n\">derivedfunc</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"k\">else</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">printf</span><span class=\"p\">(</span><span class=\"s\">&quot;cast failed</span><span class=\"se\">\\n</span><span class=\"s\">&quot;</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>We can call <tt class=\"docutils literal\">call_derived</tt> thus:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kt\">int</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">()</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">Derived</span><span class=\"w\"> </span><span class=\"n\">d</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">call_derived</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">d</span><span class=\"p\">);</span><span class=\"w\"></span>\n\n<span class=\"w\">  </span><span class=\"n\">Base</span><span class=\"w\"> </span><span class=\"n\">b</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"n\">call_derived</span><span class=\"p\">(</span><span class=\"o\">&amp;</span><span class=\"n\">b</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>The first call will successfully invoke <tt class=\"docutils literal\">derivedfunc</tt>; the second will not,\nbecause the <tt class=\"docutils literal\">dynamic_cast</tt> will return <tt class=\"docutils literal\">nullptr</tt> at run-time. This is\nbecause we&#39;re using C++&#39;s <em>run-time type information</em> (RTTI) capabilities here,\nwhere an actual representation of the type is stored in the generated code (most\nlikely attached to the vtable which every polymorphic object points to). C++\nalso has the <tt class=\"docutils literal\">typeid</tt> feature, but I&#39;m showing <tt class=\"docutils literal\">dynamic_cast</tt> since it&#39;s the\none most commonly used.</p>\n<p>Note particularly the differences between this sample and the C sample in the\nbeginning of the post. Conceptually, it&#39;s similar - we use a pointer to a\ngeneral type (in C that&#39;s <tt class=\"docutils literal\">void*</tt>, in the C++ example we use a base type) to\ninteract with concrete types. Whereas in C there is no built-in run-time type\nfeature, in C++ we can use RTTI in some cases. With RTTI enabled,\n<tt class=\"docutils literal\">dynamic_cast</tt> can be used to interact with the run-time (reified)\nrepresentation of types in a limited but useful way.</p>\n</div>\n<div class=\"section\" id=\"type-erasure-and-java-generics\">\n<h2>Type erasure and Java generics</h2>\n<p>One place where folks not necessarily familiar with programming language type\ntheory encounter erasure is Java generics, which were bolted onto the language\nafter a large amount of code has already been written. The designers of Java\nfaced the binary compatibility challenge, wherein they wanted code compiled with\nnewer Java compilers to run on older VMs.</p>\n<p>The solution was to use type erasure to implement generics entirely in the\ncompiler. Here&#39;s a quote from the <a class=\"reference external\" href=\"https://docs.oracle.com/javase/tutorial/java/generics/erasure.html\">official Java generics tutorial</a>:</p>\n<blockquote>\n<p>Generics were introduced to the Java language to provide tighter type checks\nat compile time and to support generic programming. To implement generics, the\nJava compiler applies type erasure to:</p>\n<ul class=\"simple\">\n<li>Replace all type parameters in generic types with their bounds or Object if\nthe type parameters are unbounded. The produced bytecode, therefore,\ncontains only ordinary classes, interfaces, and methods.</li>\n<li>Insert type casts if necessary to preserve type safety.</li>\n<li>Generate bridge methods to preserve polymorphism in extended generic types.</li>\n</ul>\n</blockquote>\n<p>Here&#39;s a very simple example to demonstrate what&#39;s going on, taken from\n<a class=\"reference external\" href=\"https://stackoverflow.com/a/339708/8206\">a Stack Overflow answer</a>. This code:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">java.util.List</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">java.util.ArrayList</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">Main</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kd\">public</span><span class=\"w\"> </span><span class=\"kd\">static</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ArrayList</span><span class=\"o\">&lt;</span><span class=\"n\">String</span><span class=\"o\">&gt;</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"na\">add</span><span class=\"p\">(</span><span class=\"s\">&quot;Hi&quot;</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"na\">get</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">System</span><span class=\"p\">.</span><span class=\"na\">out</span><span class=\"p\">.</span><span class=\"na\">println</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>Uses a generic <tt class=\"docutils literal\">List</tt>. However, what the compiler creates prior to emitting\nbytecode is equivalent to:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">java.util.List</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">java.util.ArrayList</span><span class=\"p\">;</span><span class=\"w\"></span>\n\n<span class=\"kd\">class</span> <span class=\"nc\">Main</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"kd\">public</span><span class=\"w\"> </span><span class=\"kd\">static</span><span class=\"w\"> </span><span class=\"kt\">void</span><span class=\"w\"> </span><span class=\"nf\">main</span><span class=\"p\">(</span><span class=\"n\">String</span><span class=\"o\">[]</span><span class=\"w\"> </span><span class=\"n\">args</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">List</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">new</span><span class=\"w\"> </span><span class=\"n\">ArrayList</span><span class=\"p\">();</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"na\">add</span><span class=\"p\">(</span><span class=\"s\">&quot;Hi&quot;</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">String</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">String</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">list</span><span class=\"p\">.</span><span class=\"na\">get</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">System</span><span class=\"p\">.</span><span class=\"na\">out</span><span class=\"p\">.</span><span class=\"na\">println</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">);</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"p\">}</span><span class=\"w\"></span>\n</pre></div>\n<p>Here <tt class=\"docutils literal\">List</tt> is a container of <tt class=\"docutils literal\">Object</tt>, so we can assign any element to it\n(similarly to the reification example shown in the previous section). The\ncompiler then inserts a cast when accessing that element as a string. In this\ncase the compiler will adamantly preserve type safety and won&#39;t let us do\n<tt class=\"docutils literal\">list.add(5)</tt> in the original snippet, because it sees that <tt class=\"docutils literal\">list</tt> is a\n<tt class=\"docutils literal\">List&lt;String&gt;</tt>. Therefore, the cast to <tt class=\"docutils literal\">(String)</tt> should be safe.</p>\n<p>Using type erasure to implement generics with backwards compatibility is a neat\nidea, but it has its issues. Some folks complain that not having the types\navailable at runtime is a limitation (e.g. not being able to use <tt class=\"docutils literal\">instanceof</tt>\nand other reflection capabilities). Other languages, like C# and Dart 2, have\n<em>reified generics</em> which do preserve the type information at run-time.</p>\n</div>\n<div class=\"section\" id=\"reification-in-dynamically-typed-languages\">\n<h2>Reification in dynamically typed languages</h2>\n<p>I hope it&#39;s obvious that the theory and techniques described above only apply\nto statically-typed languages. In dynamically-typed languages, like Python,\nthere is almost no concept of types at compile-time, and types are a fully\nreified concept. Even trivial errors like:</p>\n<div class=\"highlight\"><pre><span></span><span class=\"k\">class</span> <span class=\"nc\">Foo</span><span class=\"p\">:</span>\n  <span class=\"k\">def</span> <span class=\"nf\">bar</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">):</span> <span class=\"k\">pass</span>\n\n<span class=\"n\">f</span> <span class=\"o\">=</span> <span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"n\">f</span><span class=\"o\">.</span><span class=\"n\">joe</span><span class=\"p\">()</span>         <span class=\"c1\"># &lt;--- calling non-existent method</span>\n</pre></div>\n<p>Fire at run-time, because there&#39;s no static type checking <a class=\"footnote-reference\" href=\"#footnote-2\" id=\"footnote-reference-2\">[2]</a>. Types obviously\nexist at run-time, with functions like <tt class=\"docutils literal\">type()</tt> and <tt class=\"docutils literal\">isinstance()</tt> providing\ncomplete reflection capabilities. The <tt class=\"docutils literal\">type()</tt> function can even create new\ntypes <a class=\"reference external\" href=\"https://eli.thegreenplace.net/2012/04/16/python-object-creation-sequence\">entirely at run-time</a>.</p>\n<hr class=\"docutils\"></hr>\n<table class=\"docutils footnote\" frame=\"void\" id=\"footnote-1\" rules=\"none\">\n<colgroup><col class=\"label\"></col><col></col></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\"><a class=\"fn-backref\" href=\"#footnote-reference-1\">[1]</a></td><td>But it&#39;s most likely what you&#39;ll get to if you google for\n&quot;c++ type erasure&quot;.</td></tr>\n</tbody>\n</table>\n<table class=\"docutils footnote\" frame=\"void\" id=\"footnote-2\" rules=\"none\">\n<colgroup><col class=\"label\"></col><col></col></colgroup>\n<tbody valign=\"top\">\n<tr><td class=\"label\"><a class=\"fn-backref\" href=\"#footnote-reference-2\">[2]</a></td><td>To be clear - this is not a bug; it&#39;s a feature of Python. A new method\ncan be added to classes dynamically at runtime (here, some code could\nhave defined a <tt class=\"docutils literal\">joe</tt> method for <tt class=\"docutils literal\">Foo</tt> before the <tt class=\"docutils literal\">f.joe()</tt>\ninvocation), and the compiler has absolutely no way of knowing this could\nor couldn&#39;t happen. So it has to assume such invocations are valid and\nrely on run-time checking to avoid serious errors like memory corruption.</td></tr>\n</tbody>\n</table>\n</div>\n\n            </div>\n            <!-- /.entry-content -->\n<hr></hr>\n<div class=\"dotted-links\">\n<p class=\"align-center\">\nFor comments, please send me\n<a href=\"mailto:eliben@gmail.com\"><i class=\"fa fa-envelope-o\"></i> an email</a>.\n</p>\n</div>        </article>\n    </section>\n\n    </div>\n</div>\n<footer>\n   <div class=\"container\">\n      <hr>\n      <div class=\"row\">\n         <div class=\"col-xs-10\">\n            \169 2003-2024 Eli Bendersky\n         </div>\n         <div class=\"col-xs-2\"><p class=\"pull-right\"><i class=\"fa fa-arrow-up\"></i> <a href=\"#\">Back to top</a></p></div>\n      </div>\n   </div>\n</footer>\n<script src=\"//code.jquery.com/jquery-2.2.4.min.js\"></script>\n\n<!-- Include all compiled plugins (below), or include individual files as needed -->\n<script src=\"https://eli.thegreenplace.net/theme/js/bootstrap.min.js\"></script>\n\n<!--\n  Using goatcounter to count visitors. The count.js script is vendored in.\n-->\n<script data-goatcounter=\"https://stats.thegreenplace.net/count\" async src=\"https://eli.thegreenplace.net/theme/js/count.js\"></script>\n"